"use strict";(()=>{var e={};e.id=422,e.ids=[422],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},87052:(e,r,s)=>{s.r(r),s.d(r,{originalPathname:()=>v,patchFetch:()=>q,requestAsyncStorage:()=>h,routeModule:()=>f,serverHooks:()=>w,staticGenerationAsyncStorage:()=>x});var t={};s.r(t),s.d(t,{GET:()=>d,POST:()=>g});var n=s(49303),a=s(88716),o=s(60670),i=s(87070),l=s(75571),u=s(90455),p=s(52663),m=s(91585);let c=m.Ry({goals:m.IX(m.Z_()).optional(),diet:m.Z_().optional(),lifestyle:m.IX(m.Z_()).optional(),currentSupplements:m.IX(m.Z_()).optional(),age:m.Rx().optional(),gender:m.Z_().optional()});async function d(e){try{let e=await (0,l.getServerSession)(u.L);if(!e?.user)return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=await p._.user.findUnique({where:{id:e.user.id},include:{wellnessGoals:!0,supplementLogs:{include:{product:!0},orderBy:{takenAt:"desc"},take:10}}});if(!r)return i.NextResponse.json({error:"User not found"},{status:404});let s=await p._.product.findMany({include:{safetyTags:!0,seller:!0,interactions:!0},orderBy:{matchScore:"desc"}}),t=await y(r,s);return i.NextResponse.json({recommendations:t.slice(0,10),userProfile:{goals:r.wellnessGoals.map(e=>e.name),currentSupplements:r.supplementLogs.map(e=>e.product.name),age:r.age,gender:r.gender}})}catch(e){return console.error("Recommendation error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function g(e){try{let r=await (0,l.getServerSession)(u.L);if(!r?.user)return i.NextResponse.json({error:"Unauthorized"},{status:401});let s=await e.json(),t=c.parse(s),n=await p._.product.findMany({include:{safetyTags:!0,seller:!0,interactions:!0}}),a={wellnessGoals:t.goals?.map(e=>({name:e}))||[],supplementLogs:[],age:t.age,gender:t.gender},o=await y(a,n);return i.NextResponse.json({recommendations:o.slice(0,10)})}catch(e){return console.error("Recommendation error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function y(e,r){let s=[];for(let t of r){let r=0,n=[],a=e.wellnessGoals.map(e=>e.name.toLowerCase()),o=t.tags.map(e=>e.toLowerCase()),i=a.filter(e=>o.some(r=>r.includes(e)||e.includes(r)));i.length>0&&(r+=40,n.push(`Perfect for your ${i.join(", ")} goals`)),e.age&&e.gender&&("protein"===t.category&&e.age>=18&&e.age<=40&&(r+=15,n.push("Great for your age group")),"multivitamin"===t.category&&(r+=20,n.push("Essential for daily nutrition"))),r+=Math.min(5*t.safetyTags.length,25),t.safetyTags.some(e=>"FDA Certified"===e.name)&&n.push("FDA certified for safety"),t.safetyTags.some(e=>"Third-Party Tested"===e.name)&&n.push("Independently tested for quality"),e.supplementLogs.map(e=>e.product.name.toLowerCase()).some(e=>t.name.toLowerCase().includes(e.split(" ")[0]))||"multivitamin"===t.category?"multivitamin"===t.category&&(r+=15,n.push("Essential daily nutrition")):(r+=10,n.push("Complements your current supplements")),t.seller?.verificationStatus==="APPROVED"&&(r+=5,n.push("From verified seller")),(r=Math.min(Math.max(r,0),100))>=30&&s.push({...t,matchScore:r,reasons:n.slice(0,3),safetyTags:t.safetyTags.map(e=>({name:e.name,description:e.description,color:e.color})),seller:t.seller?{businessName:t.seller.businessName,verificationStatus:t.seller.verificationStatus}:null})}return s.sort((e,r)=>r.matchScore-e.matchScore)}let f=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/supplements/recommendations/route",pathname:"/api/supplements/recommendations",filename:"route",bundlePath:"app/api/supplements/recommendations/route"},resolvedPagePath:"/Users/davidzhong/Desktop/wellness-platform/app/api/supplements/recommendations/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:h,staticGenerationAsyncStorage:x,serverHooks:w}=f,v="/api/supplements/recommendations/route";function q(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:x})}},90455:(e,r,s)=>{s.d(r,{L:()=>u});var t=s(13539),n=s(53797),a=s(77234),o=s(42023),i=s.n(o),l=s(52663);let u={adapter:(0,t.N)(l._),providers:[(0,a.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET}),(0,n.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let r=await l._.user.findUnique({where:{email:e.email}});return r&&await i().compare(e.password,r.password||"")?{id:r.id,email:r.email,name:r.name,username:r.username,userType:r.userType}:null}})],session:{strategy:"jwt"},callbacks:{jwt:async({token:e,user:r})=>(r&&(e.username=r.username,e.userType=r.userType),e),session:async({session:e,token:r})=>(r&&(e.user.id=r.sub,e.user.username=r.username,e.user.userType=r.userType),e)},pages:{signIn:"/auth/signin"}}},52663:(e,r,s)=>{s.d(r,{_:()=>n});let t=require("@prisma/client"),n=globalThis.prisma??new t.PrismaClient}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[276,776,83,972,585],()=>s(87052));module.exports=t})();