"use strict";(()=>{var e={};e.id=36,e.ids=[36],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},31328:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>x,requestAsyncStorage:()=>y,routeModule:()=>h,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f});var i={};r.r(i),r.d(i,{POST:()=>m});var n=r(49303),s=r(88716),o=r(60670),a=r(87070),c=r(75571),l=r(90455),u=r(52663),p=r(91585);let d=p.Ry({supplements:p.IX(p.Z_()),medications:p.IX(p.Z_()).optional(),allergies:p.IX(p.Z_()).optional()});async function m(e){try{let t=await (0,c.getServerSession)(l.L);if(!t?.user)return a.NextResponse.json({error:"Unauthorized"},{status:401});let r=await e.json(),{supplements:i,medications:n=[],allergies:s=[]}=d.parse(r);await u._.interaction.findMany({include:{product:!0}});let o=[],p=[],m=[];for(let e of i){let t=await u._.product.findFirst({where:{name:{contains:e,mode:"insensitive"}},include:{interactions:!0}});if(t)for(let e of t.interactions){if(e.conflictingProductId){let r=await u._.product.findUnique({where:{id:e.conflictingProductId}});r&&i.includes(r.name)&&o.push({supplement1:t.name,supplement2:r.name,severity:e.severity,description:e.description,recommendation:e.recommendation})}e.conflictingMedication&&n.includes(e.conflictingMedication)&&p.push({supplement:t.name,medication:e.conflictingMedication,severity:e.severity,description:e.description,recommendation:e.recommendation})}}let h=["fish","shellfish","dairy","soy","gluten","nuts","eggs"];for(let e of i){let t=await u._.product.findFirst({where:{name:{contains:e,mode:"insensitive"}}});if(t){let e=t.ingredients.toLowerCase();for(let r of s)e.includes(r.toLowerCase())&&m.push({supplement:t.name,allergen:r,severity:"HIGH",description:`This product contains ${r} which you are allergic to.`,recommendation:"Avoid this product or consult your doctor before use."});for(let r of h)e.includes(r)&&s.some(e=>e.toLowerCase().includes(r))&&m.push({supplement:t.name,allergen:r,severity:"MODERATE",description:`This product may contain traces of ${r}.`,recommendation:"Check with your doctor if you have a severe allergy."})}}let y=100,f=[...o,...p,...m],g=f.filter(e=>"CRITICAL"===e.severity||"HIGH"===e.severity).length,v=f.filter(e=>"MODERATE"===e.severity).length;y-=30*g,y-=15*v,y=Math.max(y,0);let x="SAFE";return g>0?x="DANGEROUS":v>0?x="CAUTION":(o.length>0||p.length>0)&&(x="MONITOR"),a.NextResponse.json({safetyStatus:x,safetyScore:y,summary:{totalInteractions:o.length+p.length,allergyWarnings:m.length,criticalIssues:g,moderateIssues:v},interactions:{supplementToSupplement:o,supplementToMedication:p,allergies:m},recommendations:function(e,t,r,i){let n=[];return"DANGEROUS"===i&&n.push({priority:"HIGH",title:"Immediate Action Required",description:"These combinations pose serious health risks. Consult your doctor immediately.",action:"STOP_USE"}),t.length>0&&n.push({priority:"HIGH",title:"Medication Interactions Detected",description:"Some supplements may interact with your medications.",action:"CONSULT_DOCTOR"}),r.length>0&&n.push({priority:"HIGH",title:"Allergy Warnings",description:"Some products contain ingredients you may be allergic to.",action:"AVOID_PRODUCTS"}),e.length>0&&n.push({priority:"MODERATE",title:"Supplement Interactions",description:"Some supplements may reduce each other's effectiveness.",action:"SPACE_DOSING"}),"SAFE"===i&&n.push({priority:"LOW",title:"Safe to Use",description:"No significant interactions detected. Continue monitoring for any side effects.",action:"MONITOR"}),n}(o,p,m,x)})}catch(e){return console.error("Safety check error:",e),a.NextResponse.json({error:"Internal server error"},{status:500})}}let h=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/safety/check/route",pathname:"/api/safety/check",filename:"route",bundlePath:"app/api/safety/check/route"},resolvedPagePath:"/Users/davidzhong/Desktop/wellness-platform/app/api/safety/check/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:y,staticGenerationAsyncStorage:f,serverHooks:g}=h,v="/api/safety/check/route";function x(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:f})}},90455:(e,t,r)=>{r.d(t,{L:()=>l});var i=r(13539),n=r(53797),s=r(77234),o=r(42023),a=r.n(o),c=r(52663);let l={adapter:(0,i.N)(c._),providers:[(0,s.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET}),(0,n.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await c._.user.findUnique({where:{email:e.email}});return t&&await a().compare(e.password,t.password||"")?{id:t.id,email:t.email,name:t.name,username:t.username,userType:t.userType}:null}})],session:{strategy:"jwt"},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.username=t.username,e.userType=t.userType),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.sub,e.user.username=t.username,e.user.userType=t.userType),e)},pages:{signIn:"/auth/signin"}}},52663:(e,t,r)=>{r.d(t,{_:()=>n});let i=require("@prisma/client"),n=globalThis.prisma??new i.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[276,776,83,972,585],()=>r(31328));module.exports=i})();